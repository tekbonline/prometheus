
# ------------------------------------------------------------------------------
# Global
# ------------------------------------------------------------------------------
nameOverride: "kube-prometheus"
fullnameOverride: "kube-prometheus"

# ------------------------------------------------------------------------------
# Prometheus (served at /prometheus)
# ------------------------------------------------------------------------------
prometheus:
  enabled: true
  service:
    type: ClusterIP

  prometheusSpec:
    replicas: 2
    retention: 7d
    walCompression: true

    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: gp3
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 50Gi

    resources:
      requests:
        cpu: 500m
        memory: 2Gi
      limits:
        cpu: "2"
        memory: 6Gi

    # Discovery
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    ruleSelectorNilUsesHelmValues: false

    # Serve from subpath
    routePrefix: /prometheus
    externalUrl: /prometheus

  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/group.name: monitoring-public
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP":80}]'
      alb.ingress.kubernetes.io/healthcheck-path: /prometheus/-/ready
      alb.ingress.kubernetes.io/healthcheck-success-codes: "200"
    hosts: []
    paths:
      - /prometheus
    pathType: Prefix
    tls: []

# ------------------------------------------------------------------------------
# Alertmanager (served at /alertmanager)
# ------------------------------------------------------------------------------
alertmanager:
  enabled: true
  service:
    type: ClusterIP

  alertmanagerSpec:
    replicas: 2
    # Serve from subpath
    routePrefix: /alertmanager

    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: gp3
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi

    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: "1"
        memory: 2Gi

  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/group.name: monitoring-public
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP":80}]'
      alb.ingress.kubernetes.io/healthcheck-path: /-/ready
      alb.ingress.kubernetes.io/healthcheck-success-codes: "200"
    hosts: []
    paths:
      - /alertmanager
    pathType: Prefix
    tls: []

# ------------------------------------------------------------------------------
# Grafana (served at /grafana)
# ------------------------------------------------------------------------------
grafana:
  enabled: true
  adminUser: admin
  adminPassword: admin1234

  persistence:
    enabled: true
    storageClassName: gp3
    size: 20Gi

  service:
    type: ClusterIP

  # Serve Grafana from subpath "/grafana/"
  grafana.ini:
    server:
      # IMPORTANT: trailing slash ensures correct asset paths
      root_url: "%(protocol)s://%(domain)s/grafana/"
      serve_from_sub_path: true

  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/group.name: monitoring-public
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP":80}]'
      alb.ingress.kubernetes.io/healthcheck-path: /grafana/api/health
      alb.ingress.kubernetes.io/healthcheck-success-codes: "200"
    hosts: []
    path: /grafana
    pathType: Prefix
    tls: []

  networkPolicy:
    enabled: false

# ------------------------------------------------------------------------------
# Exporters
# ------------------------------------------------------------------------------
prometheus-node-exporter:
  enabled: true
  resources:
    requests:
      cpu: 50m
      memory: 50Mi
    limits:
      cpu: 200m
      memory: 200Mi

kube-state-metrics:
  enabled: true
  resources:
    requests:
      cpu: 100m
      memory: 150Mi
    limits:
      cpu: 300m
      memory: 300Mi

# ------------------------------------------------------------------------------
# Default rules (alerts/recording)
# ------------------------------------------------------------------------------
defaultRules:
  create: true
  rules:
    windows: false
